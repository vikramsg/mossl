from collections import List
from testing import assert_equal

from pki.rsa import verify_rsa_pkcs1v15, verify_rsa_pss_sha256

from crypto.bytes import hex_to_bytes


fn test_rsa_2048_sha256() raises:
    var pub_hex = "30820122300d06092a864886f70d01010105000382010f003082010a0282010100b18d75be557276dd7915e195afdadc1229a335b8190e95ac5d2b90f4f4c9ea8195497585b7d9e66ba591e0abfa643e56f9a9dcef909b8c9cc83315ed50f09b46d2bc20d3123eb6498b4ec5c72f3cdd45146040ed5591a48939e51114703734df0e3d7e8ede671aadaba3c8a959421a3977f424f00a7ed626750a3be1c516898a30097f85e671c03aa2805f5e39fec64a2987c9a0a8afdfc387be641b5cbf3fc33f85ada8666c6b7cdc96a88cb4581f25e99edeb1bb68a1f344135b959885aaa00d0ec07817bb3c080bc8cde1f3c87962cc6b278d00430c98a4834cab5e5a4c13a410c13a7d734b034d88bbf8a9172abbd24e287d86ab48dceb13098853629e290203010001"
    var sig_hex = "73890fc71a1220a793c6acb07cdbd1e1c4f5ceb22bc858bf33209ad5196fe08ebb451fc62d8c61b3cef7ba3902fd7b4086a44a54c763f1cf083b4ae5c1c3f664e439e7fa32065750c27f1d7d48c484b5276eac634773748ba6de9fd862450bffd64b93ea5876a49e725c66b06a3cba3eb18e656306f56ad13e7909cc18cca7cac4b347bc836aa64841515b7a30ee246a1a8f746efcfbba82d9255cd48d9563358a391ab5c82c95e5f7dff09f81861df598c581393cd253d41d3f1351976347a05096717e5d6326d285cc8ccc6b2bafa9874a21208004a75997e0277aa2d590489a082fddc8d95a35a817dc55db1b68ddbeecd5e97fff902e25d56d4a12cc2b86"
    var msg_str = "Hello RSA"

    var pub = hex_to_bytes(pub_hex)
    var sig = hex_to_bytes(sig_hex)
    var msg = List[UInt8]()
    for i in range(len(msg_str)):
        msg.append(ord(msg_str[i]))

    var ok = verify_rsa_pkcs1v15(pub, msg, sig)
    assert_equal(ok, True)


fn test_rsa_2048_sha384() raises:
    var pub_hex = "30820122300d06092a864886f70d01010105000382010f003082010a0282010100b18d75be557276dd7915e195afdadc1229a335b8190e95ac5d2b90f4f4c9ea8195497585b7d9e66ba591e0abfa643e56f9a9dcef909b8c9cc83315ed50f09b46d2bc20d3123eb6498b4ec5c72f3cdd45146040ed5591a48939e51114703734df0e3d7e8ede671aadaba3c8a959421a3977f424f00a7ed626750a3be1c516898a30097f85e671c03aa2805f5e39fec64a2987c9a0a8afdfc387be641b5cbf3fc33f85ada8666c6b7cdc96a88cb4581f25e99edeb1bb68a1f344135b959885aaa00d0ec07817bb3c080bc8cde1f3c87962cc6b278d00430c98a4834cab5e5a4c13a410c13a7d734b034d88bbf8a9172abbd24e287d86ab48dceb13098853629e290203010001"
    var sig_hex = "9eaab09caaed777048e7e5758333d4216f906e5d32d76c18eda3a218b0122f16ef1f5cab8988902e40c00fde2d8204aaea9425e6eab177b482f87bbfb44bf08d4bf5f1da1aed65e5cc0a64d569880fa9666f4ab0399cb408e74817de89ccfff23fb58a38d2565c898dffde0f4fd6b12a361b4cab056c0afb584ea2477f137ae3dc3ef260af860bfce02284b8c6d431740bf4f38a118981ed1ed8e4453b50ce9849d8a3acec74c5ca7ab719ac2474d6dad0fb7eacf55a94d5ee7691acc2460955c5f9b52bc4ed35eed5fb9b2c89b03bb8d737bb5b966d9f2d19f4cbef4fa54dc9ac5481a708ffa88eb88d0981acfd6ac5600ee87ad7bcab12bb86689d7db1d630"
    var msg_str = "Hello RSA"

    var pub = hex_to_bytes(pub_hex)
    var sig = hex_to_bytes(sig_hex)
    var msg = List[UInt8]()
    for i in range(len(msg_str)):
        msg.append(ord(msg_str[i]))

    var ok = verify_rsa_pkcs1v15(pub, msg, sig)
    assert_equal(ok, True)


fn test_rsa_2048_pss_sha256() raises:
    var pub_hex = "30820122300d06092a864886f70d01010105000382010f003082010a0282010100aa2af8434738f4fd83b5948e1dd864929935821585e1b57a444d53ba931fc334b7d3fd3b69c42de9bf2ad6fecbb9cb730e827a0ad909b15e6f364ea2f9127cde7771ec38bb40520b8a9327e09c7b4280d2026088a47a918f7cbc2f14ff559a37f0ac6499b185514fb153db6aa772309b98a7a5071a7ecc369cb8e1da2c48f75812e47a34456fd64217dbd2e497115886f80a7d1df50ad3c9744c7ab7a9758d208a3a13aaef6c5c0ada9fba2d65f4b1a9b85fafd88cc4f60da7d7ae29a903237e21c199e1a76f3b68acfd22fd62a8b9339d0b7da42d0371029596d6bf8e636a23aefed02eedf552332021a8ef03c85ead654571b20daa95a4eb96fec54e55b15b0203010001"
    var sig_hex = "2e99cbd99016fc90499a2df104be1ffd9ff51c5b1f02d5748a26d7594a0641585276f6ddfc7301e841cb2f32020a971898abd290873a323a6a1df1c4deb5228da46b42ccdfb4f43ebbaf0d84d67615bd7209cd532cb18c256ec17aaac5f7f5752f7f0c3b9aea7c87822b4545559e0ff9b4f2d0b147989bab06b12dc02e86253df7e69abf476b42f7711966d6f25d68029a8b155f7a415a387232009143caae8047e77c6109a9a1a3e52a3c1fd9fad8bcd870c517df320797a70f027bf044b46bc07af8a5072d7a7bd608098d0ccab7bef4a4a9f5e28ba86a57e8110fcc52cdad0dc3874b265ac5a6b756e3e8065a89aa8b1ffeea5b203fed4719c5135177a3ea"
    var msg_str = "Hello RSA PSS"

    var pub = hex_to_bytes(pub_hex)
    var sig = hex_to_bytes(sig_hex)
    var msg = List[UInt8]()
    for i in range(len(msg_str)):
        msg.append(ord(msg_str[i]))

    var ok = verify_rsa_pss_sha256(pub, msg, sig)
    assert_equal(ok, True)


fn main() raises:
    test_rsa_2048_sha256()
    test_rsa_2048_sha384()
    test_rsa_2048_pss_sha256()
