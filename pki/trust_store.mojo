"""Pinned trust store for TLS MVP (ECDSA intermediates)."""
from collections import List

from pki.x509 import TrustStore, load_system_trust_store

from crypto.bytes import hex_to_bytes


fn load_trust_store() -> TrustStore:
    var trust = load_system_trust_store()
    if len(trust.roots) > 0:
        return trust^
    return load_e7_trust_store()^


fn load_e7_trust_store() -> TrustStore:
    var trust = TrustStore()
    var e7_hex = "308204573082023fa003020102021100aa75f1e62b8f0a220966d38bbfd4baa1300d06092a864886f70d01010b0500304f310b300906035504061302555331293027060355040a1320496e7465726e65742053656375726974792052657365617263682047726f7570311530130603550403130c4953524720526f6f74205831301e170d3234303331333030303030305a170d3237303331323233353935395a3032310b300906035504061302555331163014060355040a130d4c6574277320456e6372797074310b30090603550403130245373076301006072a8648ce3d020106052b810400220362000441e8049308587fbe37300cc0a041eafe56da84933ec900dbab6712cff94f5309e8a82fab29e59f1546f45b624e0fd4834199b79f4072451c2c5c4a32a6c2dbc6056a65ffdadaf075b4403b146895b6a8e26a71e274655153de16d41e27c133fda381f83081f5300e0603551d0f0101ff040403020186301d0603551d250416301406082b0601050507030206082b0601050507030130120603551d130101ff040830060101ff020100301d0603551d0e04160414ae489edc871d44a06fdaa2e560740478c29c0080301f0603551d2304183016801479b459e67bb6e5e40173800888c81a58f6e99b6e303206082b0601050507010104263024302206082b060105050730028616687474703a2f2f78312e692e6c656e63722e6f72672f30130603551d20040c300a3008060667810c01020130270603551d1f0420301e301ca01aa0188616687474703a2f2f78312e632e6c656e63722e6f72672f300d06092a864886f70d01010b050003820201008f1eba7c374b939cb0167dc2cc0d70d6a7f29475036847f4419a57709b1e75d24649f6d450ebdb351f4dfd0435e8ad655e5e151728661970d3e4a75f72bd11bc8215acdc4587896a1ed45108fe91051b2da9b676cd4460a9a927fd78a9d226902f421d7c7059af7f7a1609279e245815c90a3913c6c8cdd02a777aea0b4cb2df08e67911425020fc96fe19cdde808bee18a59ba04d46f3d353b0df4b4c30f73cb8f475432b388baa5632c1f29102eb293d7a7ae5aea8d742090b118857ceaedd2da7efe5592283a1a5d27baeaa3a9fa744356e2d68c953409577ba6945f0f7609c8210bd6cdb0a10ed7e339d98639fa87c85e54bf48441bbd561804b679c9e8a0955eaddd233a1febd31b468ff581f32e7fca54e1f31907d70cfeea339b647feedd8997bba367f0e8eec8bcde9fb105c44108fc4c9517271bf6fee26172ecbfb520e05f01ccf14937e1635b453ef31931a44115f482c6e301e6bf8d80285afd19bd0470a6a3deefd0ff8bb09ea7ca969c0fbb004ff70774bfddd1046267349697b5dfae80ffa184824de4b6bf4f12842b2c286ce88b6edf09cd2c1d9eb82f082862d01691ad38eff6fe18802a3c9a8da04fdb9c358c5d1697c05baa77b7b99daad46c8f149611993eff397a66387fc554bb704bef278357009a90ae8cfc2d78964d7031b4b05da7fec734f9241fe3d7ddc942b4b72f95530163f6d996c7247f3"
    var cloudflare_ecc_ca3_hex = "308202e230820269a003020102021031eee88afb87cd9ef8336604743f9b27300a06082a8648ce3d040303304f310b300906035504061302555331183016060355040a0c0f53534c20436f72706f726174696f6e3126302406035504030c1d53534c2e636f6d20544c53205472616e73697420454343204341205232301e170d3235303532393139343934355a170d3335303532373139343934345a3051310b300906035504061302555331183016060355040a0c0f53534c20436f72706f726174696f6e3128302606035504030c1f436c6f7564666c61726520544c532049737375696e672045434320434120333059301306072a8648ce3d020106082a8648ce3d03010703420004fd1d14148e23429326cf70d089d7b11e72ac3e5d595281df1cf5d625b9d67707850b8d12b12b3f40b91f7206e0ff40520a9349f8c971b07eeee0a34551184474a38201233082011f30120603551d130101ff040830060101ff020100301f0603551d2304183016801432a2c7d8588bff7fc03cf2556933eccecc1fbc97304806082b06010505070101043c303a303806082b06010505073002862c687474703a2f2f636572742e73736c2e636f6d2f53534c2e636f6d2d544c532d542d4543432d52322e63657230110603551d20040a300830060604551d2000301d0603551d250416301406082b0601050507030206082b06010505070301303d0603551d1f043630343032a030a02e862c687474703a2f2f63726c732e73736c2e636f6d2f53534c2e636f6d2d544c532d542d4543432d52322e63726c301d0603551d0e041604148303fde7f6f54a4d1541f4ed2216d3320a3eca66300e0603551d0f0101ff040403020186300a06082a8648ce3d04030303670030640230645bf7604c0ae5dfaa71e8b54c5b37c72efd29143f8ff41a0e6338ab676692d88c2c40f1dbd2b41d64c6393608534e4e023028b00d4ef57e1b58551ba551ce7be4726ba0b5e08fe064a6406e6dd1e76f6f9a3e9087ecb3fa40d43f5e6f4d8aa77103"
    trust.add_der(hex_to_bytes(e7_hex))
    trust.add_der(hex_to_bytes(cloudflare_ecc_ca3_hex))
    return trust^
